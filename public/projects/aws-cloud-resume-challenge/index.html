<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>AWS Cloud Resume Challenge | humail khan</title><meta name=keywords content><meta name=description content="Part 1 set up SSO, S3, Route 53, and Cloudfront Set up Organization and SSO Create Organizational accounts Best practices guide for setting up AWS Organization:
(Optional) use OrgFormation / AWS Control Tower with AWS SSO This is best used for enterprise set up
SSO and Organization set up Guide
Set up billing alerts Creating a budget Open the AWS Billing console at¬†https://console.aws.amazon.com/billing/. or select Select Billing Dashboard from your account or type Billing on Search bar In the navigation pane, choose¬†Budgets."><meta name=author content="Humail Khan"><link rel=canonical href=//humailkhan829.net/projects/aws-cloud-resume-challenge/><link crossorigin=anonymous href=/assets/css/stylesheet.936699586dba2c9bb88f0cb434a740ba0c6c5036e6b2c20cae2c93b1e844e5af.css integrity="sha256-k2aZWG26LJu4jwy0NKdAugxsUDbmssIMriyTsehE5a8=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.acb54fd32bbc1982428b8850317e45d076b95012730a5936667e6bc21777692a.js integrity="sha256-rLVP0yu8GYJCi4hQMX5F0Ha5UBJzClk2Zn5rwhd3aSo=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=//humailkhan829.net/favicon.ico><link rel=icon type=image/png sizes=16x16 href=//humailkhan829.net/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=//humailkhan829.net/favicon-32x32.png><link rel=apple-touch-icon href=//humailkhan829.net/apple-touch-icon.png><link rel=mask-icon href=//humailkhan829.net/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-123-45","auto"),ga("send","pageview"))</script><meta property="og:title" content="AWS Cloud Resume Challenge"><meta property="og:description" content="Part 1 set up SSO, S3, Route 53, and Cloudfront Set up Organization and SSO Create Organizational accounts Best practices guide for setting up AWS Organization:
(Optional) use OrgFormation / AWS Control Tower with AWS SSO This is best used for enterprise set up
SSO and Organization set up Guide
Set up billing alerts Creating a budget Open the AWS Billing console at¬†https://console.aws.amazon.com/billing/. or select Select Billing Dashboard from your account or type Billing on Search bar In the navigation pane, choose¬†Budgets."><meta property="og:type" content="article"><meta property="og:url" content="//humailkhan829.net/projects/aws-cloud-resume-challenge/"><meta property="article:section" content="projects"><meta property="article:published_time" content="2022-04-05T23:15:00+07:00"><meta property="article:modified_time" content="2022-04-05T23:15:00+07:00"><meta property="og:site_name" content="humail khan"><meta name=twitter:card content="summary"><meta name=twitter:title content="AWS Cloud Resume Challenge"><meta name=twitter:description content="Part 1 set up SSO, S3, Route 53, and Cloudfront Set up Organization and SSO Create Organizational accounts Best practices guide for setting up AWS Organization:
(Optional) use OrgFormation / AWS Control Tower with AWS SSO This is best used for enterprise set up
SSO and Organization set up Guide
Set up billing alerts Creating a budget Open the AWS Billing console at¬†https://console.aws.amazon.com/billing/. or select Select Billing Dashboard from your account or type Billing on Search bar In the navigation pane, choose¬†Budgets."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Projects","item":"//humailkhan829.net/projects/"},{"@type":"ListItem","position":2,"name":"AWS Cloud Resume Challenge","item":"//humailkhan829.net/projects/aws-cloud-resume-challenge/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"AWS Cloud Resume Challenge","name":"AWS Cloud Resume Challenge","description":"Part 1 set up SSO, S3, Route 53, and Cloudfront Set up Organization and SSO Create Organizational accounts Best practices guide for setting up AWS Organization:\n(Optional) use OrgFormation / AWS Control Tower with AWS SSO This is best used for enterprise set up\nSSO and Organization set up Guide\nSet up billing alerts Creating a budget Open the AWS Billing console at¬†https://console.aws.amazon.com/billing/. or select Select Billing Dashboard from your account or type Billing on Search bar In the navigation pane, choose¬†Budgets.","keywords":[],"articleBody":"Part 1 set up SSO, S3, Route 53, and Cloudfront Set up Organization and SSO Create Organizational accounts Best practices guide for setting up AWS Organization:\n(Optional) use OrgFormation / AWS Control Tower with AWS SSO This is best used for enterprise set up\nSSO and Organization set up Guide\nSet up billing alerts Creating a budget Open the AWS Billing console at¬†https://console.aws.amazon.com/billing/. or select Select Billing Dashboard from your account or type Billing on Search bar In the navigation pane, choose¬†Budgets.\nCreate a budget if you don‚Äôt have cost explorer enabled already, enable it now. Select the monthly cost budget Fill in the details for the budget and create the budget Set up billing alerts In the navigation pane, Preferences \u003e Billing preferences.\nEnroll in receiving and invoice along with alerts To enable the monitoring of estimated charges Open the AWS Billing console at¬†https://console.aws.amazon.com/billing/.\nIn the navigation pane, choose¬†Billing Preferences.\nBy¬†Alert preferences¬†choose¬†Edit. Choose¬†Receive CloudWatch Billing Alerts. Choose¬†Save preferences. Set up Access key and verify Creating Access keys for IAM user Go to IAM under navigation pane, Access Management \u003e users Choose to view a user by clicking on their name Select Security Credentials tab and scroll down to Access Key Create the access key Creating access keys for the AWS account root Choose your account name in the navigation bar, and then choose¬†My Security Credentials. Expand the Access keys (access key ID and secret access key) section. Choose¬†Create New Access Key. AWS CLI download AWS CLI and launch it type aws configure --profile iamadmin-general Replace iamadmin-general with the name of your profile. verify if account is configured successfully: aws s3 ls --profile iamadmin-general AWS Documentation\nDeploy Static Website to AWS S3 with HTTPS using CloudFront Set up S3 Create two buckets. One for the domain name and another starting with the prefix (www.) Route 53 Domain registration and hosted zones open up https://us-east-1.console.aws.amazon.com/route53/v2/home on the navigation pane, select Registered domains\nRegister a custom domain with Route 53 or transfer one in on the navigation pane of Route 53, select Hosted zones\nCreate a new hosted zone by providing the domain name and ensure it is set to type public hosted zone Adding CDN to S3 Reference CDN is needed to speed up website, enforce HTTPS only, and block public access to S3 by using origin control.\nGetting a Secure Sockets Layer (SSL) Certificate ACM is used to secure a website from HTTP to HTTPS\nSearch for ACM or Amazon Certificate Manager in the search bar and click on certificate manager in the AWS management console\nRequest for a new certificate Request for public certificate Enter for the fully qualified domain name *.humailkhan829.net This certificate will secure any subdomain of humailkhan829.net, such as sub.humailkhan829.net or test.humailkhan829.net.\nCreating distribution Go to cloud front \u003e Distribution \u003e create distribution Specify the name, and ensure origin access control setting is enabled Under Default cache behavior \u003e Viewer, enforce HTTPS only Under Settings, Specify custom domain names and SSL cert Create CNAME redirect and Cloudfront redirect open up https://us-east-1.console.aws.amazon.com/route53/v2/home\non the navigation pane of Route 53, select Hosted zones\nSelected hosted zone and view details\nCreate these type of records\nroute for the domain to route to cloud front redirect any sub domain to root domain with CNAME record Also, the ACM should populate a CNAME entry like the following if not, go to your certificate under ACM and create a record using the CNAME name and CNAME value Errors Changes to S3 is not reflecting to CloudFront Invalidate Cloudfront cache https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/Invalidation.html#invalidating-objects-api aws cloudfront create-invalidation --distribution-id E3HKHQS3APLTXO --paths \"/*\" Permission denied error Check to see if name servers for host zone is the same for the registered domain\nRoute 53 \u003e Registered Domain \u003e select domain Route 53 \u003e Hosted Zones S3 bucket blocked public access is still public Caching problem. Wait a while and refresh the page.\nCloudfront OAI not accessing subdomain correctly There is a feature in CloudFront called the¬†default root object¬†that allows you to specify an index document that applies to the root object only, but not on any subfolders.\nif a user goes to¬†www.example.com/blog, this request is no longer on the root directory, and therefore CloudFront does not rewrite this URL and instead sends it to the origin as is\nLambda Function\nexports.handler = (event, context, callback) =\u003e { const request = event.Records[0].cf.request; let prefixPath; // needed for 2nd condition if (request.uri.match('.+/$')) { request.uri += 'index.html'; callback(null, request); } else if (prefixPath = request.uri.match('(.+)/index.html')) { const modifiedPrefixPath = prefixPath[1].replace(/^\\/+/, '/'); const response = { status: '301', statusDescription: 'Found', headers: { location: [{ key: 'Location', value: modifiedPrefixPath + '/', }], } }; callback(null, response); } else if (request.uri.match('/[^/.]+$')) { const modifiedRequestURI = request.uri.replace(/^\\/+/, '/'); const response = { status: '301', statusDescription: 'Found', headers: { location: [{ key: 'Location', value: modifiedRequestURI + '/', }], } }; callback(null, response); } else { callback(null, request); } } add trust relation for lambda function\n{ \"Effect\": \"Allow\", \"Principal\": { \"Service\": \"edgelambda.amazonaws.com\" }, \"Action\": \"sts:AssumeRole\" } Add Trigger for cloud front and set up lambda edge for origin request Set up DynamoDB, lambda api Create dynamoDB table item lambda function import json import boto3 import os table_name = os.environ.get('DB_TABLE') dynamodb = boto3.resource('dynamodb') table = dynamodb.Table(table_name) def lambda_handler(event, context): response = table.get_item(Key={ 'id':'0' }) views = response['Item']['views'] views = views + 1 print(views) response = table.put_item(Item={ 'id':'0', 'views': views }) return views You can create the environment variable under Configuration \u003e Environment variables\\\nAPI Gateway Set up API call on the navigation pane, select Resources Click Actions \u003e Create Method connect API Gateway to Lambda function Enable CORS Click Actions \u003e Enable CORS\nonce set up, enable CORS so that cloud front origin is allowed to interact with API Gateway Test API Request Body { } Response Body 1 Response Headers { \"Access-Control-Allow-Origin\": [ \"*\" ], \"Content-Type\": [ \"application/json\" ], \"X-Amzn-Trace-Id\": [ \"Root=1-647e2790-8f1e856b24006082d3123ec6;Sampled=0;lineage=60feb345:0\" ] } Website modification index.html \u003cdiv class=\"counter-number\"\u003eCouldn't read the counter\u003c/div\u003e Insert html text for your homepage\nindex.js const counter = document.querySelector(\".counter-number\"); const API_GATEWAY = \"https://dhytdke9a8.execute-api.us-east-1.amazonaws.com/dev\" async function updateCounter() { var header = new Headers() header.append(\"Content-Type\", \"application/json\") var requestOptions = { method: 'POST', Headers: header, body: {}, redirect: 'follow' } const response = await fetch(API_GATEWAY); let data = await response.json(); counter.innerHTML = `üëÄ Views: ${data}`; } updateCounter(); replace API_GATEWAY with your URL.\nSet up CI/CD Setting up GitHub actions Create the file .github/workflows inside your project and create main.yaml with the following config Main.yaml\nname: Upload Website onto S3 on: push: branches: - main jobs: deploy: runs-on: ubuntu-latest steps: - uses: actions/checkout@master - uses: jakejarvis/s3-sync-action@master with: args: --acl public-read --follow-symlinks --delete --exclude '.git/*' env: AWS_S3_BUCKET: ${{ secrets.AWS_S3_BUCKET }} AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }} AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }} AWS_REGION: 'us-west-1' SOURCE_DIR: 'public' Setting up Secrets On github page, move to Settings\nOn the left navigation pane, Security \u003e Secrets and variables \u003e Actions\nCreate new repository secrets AWS_S3_BUCKET is the name of the s3 bucket, not the ARN.\nVerify changes Create a new PR to the repo and go to actions. The workflow will start deploying the PR onto the S3. Errors ACL blocking github/floworks upload failed: public/page/index.html to s3://***/page/index.html An error occurred (AccessDenied) when calling the PutObject operation: Access Denied\nConfigure S3 bucket to allow public access to ACL Change the ownership of the bucket to enable ACLs Verify that the bucket owner has Write access to the bucket. This assumes the access keys belongs to the bucket owner. ‚ÄòInternal Server Error‚Äô when calling lambda function to update dynamoDB Missing permission. Lambda function \u003e Permission \u003e execution role Attach the following policies ERROR: {‚Äúmessage‚Äù:‚ÄúMissing Authentication Token‚Äù} The API gateway link cannot directly be called, instead pass in a Request Body\n","wordCount":"1288","inLanguage":"en","datePublished":"2022-04-05T23:15:00+07:00","dateModified":"2022-04-05T23:15:00+07:00","author":{"@type":"Person","name":"Humail Khan"},"mainEntityOfPage":{"@type":"WebPage","@id":"//humailkhan829.net/projects/aws-cloud-resume-challenge/"},"publisher":{"@type":"Organization","name":"humail khan","logo":{"@type":"ImageObject","url":"//humailkhan829.net/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=//humailkhan829.net/ accesskey=h title="Home (Alt + H)"><img src=//humailkhan829.net/images/coding.png alt aria-label=logo height=35>Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=//humailkhan829.net/projects/ title=Projects><span>Projects</span></a></li><li><a href=//humailkhan829.net/resume/ title=Resume><span>Resume</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=//humailkhan829.net/>Home</a>&nbsp;¬ª&nbsp;<a href=//humailkhan829.net/projects/>Projects</a></div><h1 class=post-title>AWS Cloud Resume Challenge</h1><div class=post-meta><span title='2022-04-05 23:15:00 +0700 +0700'>April 5, 2022</span>&nbsp;¬∑&nbsp;7 min&nbsp;¬∑&nbsp;1288 words&nbsp;¬∑&nbsp;Humail Khan</div></header><div class=post-content><h1 id=part-1-set-up-sso-s3-route-53-and-cloudfront>Part 1 set up SSO, S3, Route 53, and Cloudfront<a hidden class=anchor aria-hidden=true href=#part-1-set-up-sso-s3-route-53-and-cloudfront>#</a></h1><h2 id=set-up-organization-and-sso>Set up Organization and SSO<a hidden class=anchor aria-hidden=true href=#set-up-organization-and-sso>#</a></h2><h3 id=create-organizational-accounts>Create Organizational accounts<a hidden class=anchor aria-hidden=true href=#create-organizational-accounts>#</a></h3><p><a href=https://github.com/org-formation/org-formation-cli/blob/master/docs/articles/aws-organizations.md>Best practices guide for setting up AWS Organization</a>:</p><p><a href=https://github.com/org-formation/org-formation-cli/blob/master/docs/articles/org-formation.md>(Optional) use OrgFormation / AWS Control Tower with AWS SSO</a> This is best used for enterprise set up</p><p><a href=https://dev.to/aws-builders/minimal-aws-sso-setup-for-personal-aws-development-220k>SSO and Organization set up Guide</a></p><h2 id=set-up-billing-alerts>Set up billing alerts<a hidden class=anchor aria-hidden=true href=#set-up-billing-alerts>#</a></h2><h4 id=creating-a-budget>Creating a budget<a hidden class=anchor aria-hidden=true href=#creating-a-budget>#</a></h4><p>Open the AWS Billing console at¬†<a href=https://console.aws.amazon.com/billing/home?#/>https://console.aws.amazon.com/billing/</a>.
or select Select Billing Dashboard from your account or type <code>Billing</code> on Search bar
<img loading=lazy src=/projects/images/Pasted%20image%2020221009164514.png alt="Alt Text">
In the navigation pane, choose¬†<strong>Budgets</strong>.<br>Create a budget
<img loading=lazy src=/projects/images/Pasted%20image%2020221009164844.png alt="Alt Text">
if you don&rsquo;t have cost explorer enabled already, enable it now.
<img loading=lazy src=/projects/images/Pasted%20image%2020221009165153.png alt="Alt Text">
Select the monthly cost budget
<img loading=lazy src=/projects/images/Pasted%20image%2020230531152459.png alt="Alt Text">
Fill in the details for the budget and create the budget
<img loading=lazy src=/projects/images/Pasted%20image%2020230531152543.png alt="Alt Text"></p><h4 id=set-up-billing-alerts-1>Set up billing alerts<a hidden class=anchor aria-hidden=true href=#set-up-billing-alerts-1>#</a></h4><p>In the navigation pane, Preferences > Billing preferences.<br>Enroll in receiving and invoice along with alerts
<img loading=lazy src=/projects/images/Pasted%20image%2020221009164702.png alt="Alt Text"></p><h4 id=to-enable-the-monitoring-of-estimated-charges>To enable the monitoring of estimated charges<a hidden class=anchor aria-hidden=true href=#to-enable-the-monitoring-of-estimated-charges>#</a></h4><p>Open the AWS Billing console at¬†<a href=https://console.aws.amazon.com/billing/home?#/>https://console.aws.amazon.com/billing/</a>.<br>In the navigation pane, choose¬†<strong>Billing Preferences</strong>.<br>By¬†<strong>Alert preferences</strong>¬†choose¬†<strong>Edit</strong>.
<img loading=lazy src=/projects/images/Pasted%20image%2020230605122733.png alt="Alt Text">
Choose¬†<strong>Receive CloudWatch Billing Alerts</strong>.
Choose¬†<strong>Save preferences</strong>.
<img loading=lazy src=/projects/images/Pasted%20image%2020230605122758.png alt="Alt Text"></p><h2 id=set-up-access-key-and-verify>Set up Access key and verify<a hidden class=anchor aria-hidden=true href=#set-up-access-key-and-verify>#</a></h2><h4 id=creating-access-keys-for-iam-user>Creating Access keys for IAM user<a hidden class=anchor aria-hidden=true href=#creating-access-keys-for-iam-user>#</a></h4><ol><li>Go to IAM</li><li>under navigation pane, <strong>Access Management > users</strong></li><li>Choose to view a user by clicking on their name</li><li>Select <code>Security Credentials</code> tab and scroll down to Access Key
<img loading=lazy src=/projects/images/Pasted%20image%2020230531153517.png alt="Alt Text"></li><li>Create the access key
<img loading=lazy src=/projects/images/Pasted%20image%2020230403233243.png alt="Alt Text"></li></ol><h4 id=creating-access-keys-for-the-aws-account-root>Creating access keys for the AWS account root<a hidden class=anchor aria-hidden=true href=#creating-access-keys-for-the-aws-account-root>#</a></h4><ol><li>Choose your account name in the navigation bar, and then choose¬†<strong>My Security Credentials</strong>.
<img loading=lazy src=/projects/images/Pasted%20image%2020230412192125.png alt="Alt Text">
Expand the Access keys (access key ID and secret access key) section.
Choose¬†<strong>Create New Access Key</strong>.</li></ol><h4 id=aws-cli>AWS CLI<a hidden class=anchor aria-hidden=true href=#aws-cli>#</a></h4><p>download <a href=https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html>AWS CLI</a> and launch it
type <code>aws configure --profile iamadmin-general</code>
Replace <code>iamadmin-general</code> with the name of your profile.
<img loading=lazy src=/projects/images/Pasted%20image%2020230403233450.png alt="Alt Text">
verify if account is configured successfully: <code>aws s3 ls --profile iamadmin-general</code>
<img loading=lazy src=/projects/images/Pasted%20image%2020230403233507.png alt="Alt Text">
<a href=https://docs.aws.amazon.com/accounts/latest/reference/root-user-access-key.html>AWS Documentation</a></p><h2 id=deploy-static-website-to-aws-s3-with-https-using-cloudfront>Deploy Static Website to AWS S3 with HTTPS using CloudFront<a hidden class=anchor aria-hidden=true href=#deploy-static-website-to-aws-s3-with-https-using-cloudfront>#</a></h2><h3 id=set-up-s3>Set up S3<a hidden class=anchor aria-hidden=true href=#set-up-s3>#</a></h3><p>Create two buckets. One for the domain name and another starting with the prefix (www.)
<img loading=lazy src=/projects/images/Pasted%20image%2020230605124226.png alt="Alt Text"></p><h3 id=route-53-domain-registration-and-hosted-zones>Route 53 Domain registration and hosted zones<a hidden class=anchor aria-hidden=true href=#route-53-domain-registration-and-hosted-zones>#</a></h3><p>open up <a href=https://us-east-1.console.aws.amazon.com/route53/v2/home>https://us-east-1.console.aws.amazon.com/route53/v2/home</a>
on the navigation pane, select <strong>Registered domains</strong><br>Register a custom domain with Route 53 or transfer one in
<img loading=lazy src=/projects/images/Pasted%20image%2020230605124148.png alt="Alt Text">
on the navigation pane of Route 53, select <strong>Hosted zones</strong><br>Create a new hosted zone by providing the domain name and ensure it is set to type <strong>public hosted zone</strong>
<img loading=lazy src=/projects/images/Pasted%20image%2020230605140535.png alt="Alt Text"></p><h3 id=adding-cdn-to-s3>Adding CDN to S3<a hidden class=anchor aria-hidden=true href=#adding-cdn-to-s3>#</a></h3><p><a href=https://docs.aws.amazon.com/AmazonS3/latest/userguide/website-hosting-cloudfront-walkthrough.html>Reference</a>
CDN is needed to speed up website, enforce HTTPS only, and block public access to S3 by using origin control.</p><h4 id=getting-a-secure-sockets-layer-ssl-certificate>Getting a Secure Sockets Layer (SSL) Certificate<a hidden class=anchor aria-hidden=true href=#getting-a-secure-sockets-layer-ssl-certificate>#</a></h4><p>ACM is used to secure a website from HTTP to HTTPS</p><p>Search for ACM or Amazon Certificate Manager in the search bar and click on certificate manager in the AWS management console</p><p>Request for a new certificate
<img loading=lazy src=/projects/images/Pasted%20image%2020230605141101.png alt="Alt Text">
Request for public certificate
<img loading=lazy src=/projects/images/Pasted%20image%2020230605141115.png alt="Alt Text">
Enter for the fully qualified domain name
<code>*.humailkhan829.net</code>
This certificate will secure any subdomain of <em>humailkhan829.net</em>, such as <em>sub.humailkhan829.net</em> or <em>test.humailkhan829.net</em>.</p><h4 id=creating-distribution>Creating distribution<a hidden class=anchor aria-hidden=true href=#creating-distribution>#</a></h4><p>Go to cloud front > Distribution > create distribution
<img loading=lazy src=/projects/images/Pasted%20image%2020230605141836.png alt="Alt Text">
Specify the name, and ensure origin access control setting is enabled
<img loading=lazy src=/projects/images/Pasted%20image%2020230605142003.png alt="Alt Text">
Under <strong>Default cache behavior > Viewer</strong>, enforce HTTPS only
<img loading=lazy src=/projects/images/Pasted%20image%2020230605142048.png alt="Alt Text">
Under <strong>Settings</strong>, Specify custom domain names and SSL cert
<img loading=lazy src=/projects/images/Pasted%20image%2020230605142312.png alt="Alt Text"></p><h3 id=create-cname-redirect-and-cloudfront-redirect>Create CNAME redirect and Cloudfront redirect<a hidden class=anchor aria-hidden=true href=#create-cname-redirect-and-cloudfront-redirect>#</a></h3><p>open up <a href=https://us-east-1.console.aws.amazon.com/route53/v2/home>https://us-east-1.console.aws.amazon.com/route53/v2/home</a><br>on the navigation pane of Route 53, select <strong>Hosted zones</strong><br>Selected hosted zone and view details<br>Create these type of records</p><ol><li>route for the domain to route to cloud front
<img loading=lazy src=/projects/images/Pasted%20image%2020230605143002.png alt="Alt Text"></li><li>redirect any sub domain to root domain with CNAME record
<img loading=lazy src=/projects/images/Pasted%20image%2020230605143210.png alt="Alt Text">
Also, the ACM should populate a CNAME entry like the following
<img loading=lazy src=/projects/images/Pasted%20image%2020230605143416.png alt="Alt Text">
if not, go to your certificate under ACM and create a record using the CNAME name and CNAME value
<img loading=lazy src=/projects/images/Pasted%20image%2020230605143656.png alt="Alt Text"></li></ol><h3 id=errors>Errors<a hidden class=anchor aria-hidden=true href=#errors>#</a></h3><h4 id=changes-to-s3-is-not-reflecting-to-cloudfront>Changes to S3 is not reflecting to CloudFront<a hidden class=anchor aria-hidden=true href=#changes-to-s3-is-not-reflecting-to-cloudfront>#</a></h4><p>Invalidate Cloudfront cache
<a href=https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/Invalidation.html#invalidating-objects-api>https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/Invalidation.html#invalidating-objects-api</a>
<code>aws cloudfront create-invalidation --distribution-id E3HKHQS3APLTXO --paths "/*"</code>
<img loading=lazy src=Bins/Images//projects/images/Pasted%20image%2020230202130333.png alt="Alt Text"></p><h4 id=permission-denied-error>Permission denied error<a hidden class=anchor aria-hidden=true href=#permission-denied-error>#</a></h4><p>Check to see if name servers for host zone is the same for the registered domain</p><p>Route 53 > Registered Domain > select domain
<img loading=lazy src=/projects/images/Pasted%20image%2020230516222217.png alt="Alt Text">
Route 53 > Hosted Zones
<img loading=lazy src=/projects/images/Pasted%20image%2020230516222243.png alt="Alt Text"></p><h4 id=s3-bucket-blocked-public-access-is-still-public>S3 bucket blocked public access is still public<a hidden class=anchor aria-hidden=true href=#s3-bucket-blocked-public-access-is-still-public>#</a></h4><p><img loading=lazy src=/projects/images/Pasted%20image%2020230529151206.png alt="Alt Text">
Caching problem. Wait a while and refresh the page.</p><h4 id=cloudfront-oai-not-accessing-subdomain-correctly>Cloudfront OAI not accessing subdomain correctly<a hidden class=anchor aria-hidden=true href=#cloudfront-oai-not-accessing-subdomain-correctly>#</a></h4><p>There is a feature in CloudFront called the¬†<a href=https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/DefaultRootObject.html>default root object</a>¬†that allows you to specify an index document that applies to the root object only, but not on any subfolders.</p><p>if a user goes to¬†<code>www.example.com/blog</code>, this request is no longer on the root directory, and therefore CloudFront does not rewrite this URL and instead sends it to the origin as is</p><p>Lambda Function</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>exports</span><span class=p>.</span><span class=nx>handler</span> <span class=o>=</span> <span class=p>(</span><span class=nx>event</span><span class=p>,</span> <span class=nx>context</span><span class=p>,</span> <span class=nx>callback</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>request</span> <span class=o>=</span> <span class=nx>event</span><span class=p>.</span><span class=nx>Records</span><span class=p>[</span><span class=mi>0</span><span class=p>].</span><span class=nx>cf</span><span class=p>.</span><span class=nx>request</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kd>let</span> <span class=nx>prefixPath</span><span class=p>;</span> <span class=c1>// needed for 2nd condition
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>request</span><span class=p>.</span><span class=nx>uri</span><span class=p>.</span><span class=nx>match</span><span class=p>(</span><span class=s1>&#39;.+/$&#39;</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>request</span><span class=p>.</span><span class=nx>uri</span> <span class=o>+=</span> <span class=s1>&#39;index.html&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nx>callback</span><span class=p>(</span><span class=kc>null</span><span class=p>,</span> <span class=nx>request</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=nx>prefixPath</span> <span class=o>=</span> <span class=nx>request</span><span class=p>.</span><span class=nx>uri</span><span class=p>.</span><span class=nx>match</span><span class=p>(</span><span class=s1>&#39;(.+)/index.html&#39;</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>modifiedPrefixPath</span> <span class=o>=</span> <span class=nx>prefixPath</span><span class=p>[</span><span class=mi>1</span><span class=p>].</span><span class=nx>replace</span><span class=p>(</span><span class=sr>/^\/+/</span><span class=p>,</span> <span class=s1>&#39;/&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>response</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>status</span><span class=o>:</span> <span class=s1>&#39;301&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>statusDescription</span><span class=o>:</span> <span class=s1>&#39;Found&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>headers</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>location</span><span class=o>:</span> <span class=p>[{</span>
</span></span><span class=line><span class=cl>          <span class=nx>key</span><span class=o>:</span> <span class=s1>&#39;Location&#39;</span><span class=p>,</span> <span class=nx>value</span><span class=o>:</span> <span class=nx>modifiedPrefixPath</span> <span class=o>+</span> <span class=s1>&#39;/&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>}],</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=nx>callback</span><span class=p>(</span><span class=kc>null</span><span class=p>,</span> <span class=nx>response</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=nx>request</span><span class=p>.</span><span class=nx>uri</span><span class=p>.</span><span class=nx>match</span><span class=p>(</span><span class=s1>&#39;/[^/.]+$&#39;</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>modifiedRequestURI</span> <span class=o>=</span> <span class=nx>request</span><span class=p>.</span><span class=nx>uri</span><span class=p>.</span><span class=nx>replace</span><span class=p>(</span><span class=sr>/^\/+/</span><span class=p>,</span> <span class=s1>&#39;/&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>response</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>status</span><span class=o>:</span> <span class=s1>&#39;301&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>statusDescription</span><span class=o>:</span> <span class=s1>&#39;Found&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>headers</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>location</span><span class=o>:</span> <span class=p>[{</span>
</span></span><span class=line><span class=cl>          <span class=nx>key</span><span class=o>:</span> <span class=s1>&#39;Location&#39;</span><span class=p>,</span> <span class=nx>value</span><span class=o>:</span> <span class=nx>modifiedRequestURI</span> <span class=o>+</span> <span class=s1>&#39;/&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>}],</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=nx>callback</span><span class=p>(</span><span class=kc>null</span><span class=p>,</span> <span class=nx>response</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>callback</span><span class=p>(</span><span class=kc>null</span><span class=p>,</span> <span class=nx>request</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>add trust relation for lambda function</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nt>&#34;Effect&#34;</span><span class=p>:</span> <span class=s2>&#34;Allow&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=nt>&#34;Principal&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nt>&#34;Service&#34;</span><span class=p>:</span> <span class=s2>&#34;edgelambda.amazonaws.com&#34;</span>
</span></span><span class=line><span class=cl>	<span class=p>},</span>
</span></span><span class=line><span class=cl>	<span class=nt>&#34;Action&#34;</span><span class=p>:</span> <span class=s2>&#34;sts:AssumeRole&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Add Trigger for cloud front and set up lambda edge for origin request
<img loading=lazy src=/projects/images/Pasted%20image%2020230529162036.png alt="Alt Text"></p><h1 id=set-up-dynamodb-lambda-api>Set up DynamoDB, lambda api<a hidden class=anchor aria-hidden=true href=#set-up-dynamodb-lambda-api>#</a></h1><h3 id=create-dynamodb-table-item>Create dynamoDB table item<a hidden class=anchor aria-hidden=true href=#create-dynamodb-table-item>#</a></h3><p><img loading=lazy src=/projects/images/Pasted%20image%2020230529182253.png alt="Alt Text"></p><h3 id=lambda-function>lambda function<a hidden class=anchor aria-hidden=true href=#lambda-function>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>boto3</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl><span class=n>table_name</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>environ</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;DB_TABLE&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>dynamodb</span> <span class=o>=</span> <span class=n>boto3</span><span class=o>.</span><span class=n>resource</span><span class=p>(</span><span class=s1>&#39;dynamodb&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>table</span> <span class=o>=</span> <span class=n>dynamodb</span><span class=o>.</span><span class=n>Table</span><span class=p>(</span><span class=n>table_name</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>lambda_handler</span><span class=p>(</span><span class=n>event</span><span class=p>,</span> <span class=n>context</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>response</span> <span class=o>=</span> <span class=n>table</span><span class=o>.</span><span class=n>get_item</span><span class=p>(</span><span class=n>Key</span><span class=o>=</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;id&#39;</span><span class=p>:</span><span class=s1>&#39;0&#39;</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=n>views</span> <span class=o>=</span> <span class=n>response</span><span class=p>[</span><span class=s1>&#39;Item&#39;</span><span class=p>][</span><span class=s1>&#39;views&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>views</span> <span class=o>=</span> <span class=n>views</span> <span class=o>+</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>views</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>response</span> <span class=o>=</span> <span class=n>table</span><span class=o>.</span><span class=n>put_item</span><span class=p>(</span><span class=n>Item</span><span class=o>=</span><span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;id&#39;</span><span class=p>:</span><span class=s1>&#39;0&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;views&#39;</span><span class=p>:</span> <span class=n>views</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>views</span>
</span></span></code></pre></div><p>You can create the environment variable under Configuration > Environment variables\</p><h3 id=api-gateway>API Gateway<a hidden class=anchor aria-hidden=true href=#api-gateway>#</a></h3><h4 id=set-up-api-call>Set up API call<a hidden class=anchor aria-hidden=true href=#set-up-api-call>#</a></h4><p>on the navigation pane, select <strong>Resources</strong>
Click Actions > Create Method
<img loading=lazy src=/projects/images/Pasted%20image%2020230605131725.png alt="Alt Text">
connect API Gateway to Lambda function
<img loading=lazy src=/projects/images/Pasted%20image%2020230605135636.png alt="Alt Text"></p><h4 id=enable-cors>Enable CORS<a hidden class=anchor aria-hidden=true href=#enable-cors>#</a></h4><p>Click Actions > Enable CORS<br>once set up, enable CORS so that cloud front origin is allowed to interact with API Gateway
<img loading=lazy src=/projects/images/Pasted%20image%2020230605135855.png alt="Alt Text"></p><h4 id=test-api>Test API<a hidden class=anchor aria-hidden=true href=#test-api>#</a></h4><p><img loading=lazy src=/projects/images/Pasted%20image%2020230605132231.png alt="Alt Text"></p><h5 id=request-body>Request Body<a hidden class=anchor aria-hidden=true href=#request-body>#</a></h5><pre tabindex=0><code>{
    
}
</code></pre><h5 id=response-body>Response Body<a hidden class=anchor aria-hidden=true href=#response-body>#</a></h5><pre tabindex=0><code>1
</code></pre><h5 id=response-headers>Response Headers<a hidden class=anchor aria-hidden=true href=#response-headers>#</a></h5><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;Access-Control-Allow-Origin&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;*&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;Content-Type&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;application/json&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;X-Amzn-Trace-Id&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Root=1-647e2790-8f1e856b24006082d3123ec6;Sampled=0;lineage=60feb345:0&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=website-modification>Website modification<a hidden class=anchor aria-hidden=true href=#website-modification>#</a></h3><h4 id=indexhtml>index.html<a hidden class=anchor aria-hidden=true href=#indexhtml>#</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;counter-number&#34;</span><span class=p>&gt;</span>Couldn&#39;t read the counter<span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span></code></pre></div><p>Insert html text for your homepage</p><h4 id=indexjs>index.js<a hidden class=anchor aria-hidden=true href=#indexjs>#</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>counter</span> <span class=o>=</span> <span class=nb>document</span><span class=p>.</span><span class=nx>querySelector</span><span class=p>(</span><span class=s2>&#34;.counter-number&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>API_GATEWAY</span> <span class=o>=</span> <span class=s2>&#34;https://dhytdke9a8.execute-api.us-east-1.amazonaws.com/dev&#34;</span>
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=kd>function</span> <span class=nx>updateCounter</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kd>var</span> <span class=nx>header</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Headers</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=nx>header</span><span class=p>.</span><span class=nx>append</span><span class=p>(</span><span class=s2>&#34;Content-Type&#34;</span><span class=p>,</span> <span class=s2>&#34;application/json&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=kd>var</span> <span class=nx>requestOptions</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>method</span><span class=o>:</span> <span class=s1>&#39;POST&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>Headers</span><span class=o>:</span> <span class=nx>header</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>body</span><span class=o>:</span> <span class=p>{},</span>
</span></span><span class=line><span class=cl>            <span class=nx>redirect</span><span class=o>:</span> <span class=s1>&#39;follow&#39;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>response</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>fetch</span><span class=p>(</span><span class=nx>API_GATEWAY</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=kd>let</span> <span class=nx>data</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>response</span><span class=p>.</span><span class=nx>json</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=nx>counter</span><span class=p>.</span><span class=nx>innerHTML</span> <span class=o>=</span> <span class=sb>`üëÄ Views: </span><span class=si>${</span><span class=nx>data</span><span class=si>}</span><span class=sb>`</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>updateCounter</span><span class=p>();</span>
</span></span></code></pre></div><blockquote><p>replace <strong>API_GATEWAY</strong> with your URL.</p></blockquote><h1 id=set-up-cicd>Set up CI/CD<a hidden class=anchor aria-hidden=true href=#set-up-cicd>#</a></h1><h4 id=setting-up-github-actions>Setting up GitHub actions<a hidden class=anchor aria-hidden=true href=#setting-up-github-actions>#</a></h4><p>Create the file <code>.github/workflows</code> inside your project and create <code>main.yaml</code> with the following config
<strong>Main.yaml</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Upload Website onto S3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>on</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>push</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>branches</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>main</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>jobs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>deploy</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>runs-on</span><span class=p>:</span><span class=w> </span><span class=l>ubuntu-latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>steps</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>actions/checkout@master</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>jakejarvis/s3-sync-action@master</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>with</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>args</span><span class=p>:</span><span class=w> </span>--<span class=l>acl public-read --follow-symlinks --delete --exclude &#39;.git/*&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>env</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>AWS_S3_BUCKET</span><span class=p>:</span><span class=w> </span><span class=l>${{ secrets.AWS_S3_BUCKET }}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>AWS_ACCESS_KEY_ID</span><span class=p>:</span><span class=w> </span><span class=l>${{ secrets.AWS_ACCESS_KEY_ID }}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>AWS_SECRET_ACCESS_KEY</span><span class=p>:</span><span class=w> </span><span class=l>${{ secrets.AWS_SECRET_ACCESS_KEY }}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>AWS_REGION</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;us-west-1&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>SOURCE_DIR</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;public&#39;</span><span class=w>
</span></span></span></code></pre></div><h4 id=setting-up-secrets>Setting up Secrets<a hidden class=anchor aria-hidden=true href=#setting-up-secrets>#</a></h4><p>On github page, move to Settings<br>On the left navigation pane, Security > Secrets and variables > Actions<br>Create new repository secrets
<img loading=lazy src=/projects/images/Pasted%20image%2020230531174217.png alt="Alt Text"></p><blockquote><p>AWS_S3_BUCKET is the name of the s3 bucket, not the ARN.</p></blockquote><h4 id=verify-changes>Verify changes<a hidden class=anchor aria-hidden=true href=#verify-changes>#</a></h4><p>Create a new PR to the repo and go to actions. The workflow will start deploying the PR onto the S3.
<img loading=lazy src=/projects/images/Pasted%20image%2020230531174459.png alt="Alt Text"></p><h3 id=errors-1>Errors<a hidden class=anchor aria-hidden=true href=#errors-1>#</a></h3><h4 id=acl-blocking-githubfloworks>ACL blocking github/floworks<a hidden class=anchor aria-hidden=true href=#acl-blocking-githubfloworks>#</a></h4><p>upload failed: public/page/index.html to s3://***/page/index.html An error occurred (AccessDenied) when calling the PutObject operation: Access Denied</p><ol><li>Configure S3 bucket to allow public access to ACL
<img loading=lazy src=/projects/images/Pasted%20image%2020230529193837.png alt="Alt Text"></li><li>Change the ownership of the bucket to enable ACLs
<img loading=lazy src=/projects/images/Pasted%20image%2020230529193857.png alt="Alt Text"></li><li>Verify that the bucket owner has Write access to the bucket. This assumes the access keys belongs to the bucket owner.
<img loading=lazy src=/projects/images/Pasted%20image%2020230529193914.png alt="Alt Text"></li></ol><h4 id=internal-server-error-when-calling-lambda-function-to-update-dynamodb>&lsquo;Internal Server Error&rsquo; when calling lambda function to update dynamoDB<a hidden class=anchor aria-hidden=true href=#internal-server-error-when-calling-lambda-function-to-update-dynamodb>#</a></h4><p>Missing permission.
Lambda function > Permission > execution role
<img loading=lazy src=/projects/images/Pasted%20image%2020230529171333.png alt="Alt Text">
Attach the following policies
<img loading=lazy src=/projects/images/Pasted%20image%2020230529171309.png alt="Alt Text"></p><h4 id=error-messagemissing-authentication-token>ERROR: {&ldquo;message&rdquo;:&ldquo;Missing Authentication Token&rdquo;}<a hidden class=anchor aria-hidden=true href=#error-messagemissing-authentication-token>#</a></h4><p>The API gateway link cannot directly be called, instead pass in a Request Body</p></div><footer class=post-footer><ul class=post-tags></ul><nav class=paginav><a class=prev href=//humailkhan829.net/projects/reproducible-computational-drug-discovery/><span class=title>¬´ Prev</span><br><span>Towards reproducible computational drug discovery</span></a>
<a class=next href=//humailkhan829.net/projects/acetylcholinesterase/><span class=title>Next ¬ª</span><br><span>Probing the origins of human acetylcholinesterase inhibition via QSAR modeling and molecular docking</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share AWS Cloud Resume Challenge on twitter" href="https://twitter.com/intent/tweet/?text=AWS%20Cloud%20Resume%20Challenge&url=%2f%2fhumailkhan829.net%2fprojects%2faws-cloud-resume-challenge%2f&hashtags="><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share AWS Cloud Resume Challenge on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=%2f%2fhumailkhan829.net%2fprojects%2faws-cloud-resume-challenge%2f&title=AWS%20Cloud%20Resume%20Challenge&summary=AWS%20Cloud%20Resume%20Challenge&source=%2f%2fhumailkhan829.net%2fprojects%2faws-cloud-resume-challenge%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share AWS Cloud Resume Challenge on reddit" href="https://reddit.com/submit?url=%2f%2fhumailkhan829.net%2fprojects%2faws-cloud-resume-challenge%2f&title=AWS%20Cloud%20Resume%20Challenge"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share AWS Cloud Resume Challenge on facebook" href="https://facebook.com/sharer/sharer.php?u=%2f%2fhumailkhan829.net%2fprojects%2faws-cloud-resume-challenge%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share AWS Cloud Resume Challenge on whatsapp" href="https://api.whatsapp.com/send?text=AWS%20Cloud%20Resume%20Challenge%20-%20%2f%2fhumailkhan829.net%2fprojects%2faws-cloud-resume-challenge%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share AWS Cloud Resume Challenge on telegram" href="https://telegram.me/share/url?text=AWS%20Cloud%20Resume%20Challenge&url=%2f%2fhumailkhan829.net%2fprojects%2faws-cloud-resume-challenge%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2023 <a href=//humailkhan829.net/>humail khan</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>